<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Management System</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple localStorage wrapper to mimic persistent storage
        const storage = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? { value: data } : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, value);
            }
        };

        // Lucide icons as SVG components
        const User = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const BookOpen = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>;
        const Video = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>;
        const Award = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>;
        const Upload = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const Users = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const Settings = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m7.07-14.07l-4.24 4.24m0 5.66l4.24 4.24M1 12h6m6 0h6m-4.24-7.07l-4.24 4.24m0 5.66l-4.24 4.24"/></svg>;
        const LogOut = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
        const Menu = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>;
        const X = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const Play = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>;
        const CheckCircle = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const XCircle = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>;
        const Loader = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>;

        const SchoolManagementSystem = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [loading, setLoading] = useState(true);
            
            const [students, setStudents] = useState([]);
            const [teachers, setTeachers] = useState([]);
            const [examResults, setExamResults] = useState([]);
            const [questions, setQuestions] = useState([]);
            const [videos, setVideos] = useState([]);
            const [disciplineComments, setDisciplineComments] = useState([]);
            
            const [quizAnswers, setQuizAnswers] = useState({});
            const [quizSubmitted, setQuizSubmitted] = useState(false);
            const [selectedVideo, setSelectedVideo] = useState(null);

            const [loginEmail, setLoginEmail] = useState('');
            const [loginPassword, setLoginPassword] = useState('');
            const [loginRole, setLoginRole] = useState('student');

            useEffect(() => {
                loadAllData();
            }, []);

            const loadAllData = () => {
                try {
                    setLoading(true);
                    
                    const studentsData = storage.get('students');
                    if (studentsData) {
                        setStudents(JSON.parse(studentsData.value));
                    } else {
                        const defaultStudents = [
                            { id: 1, name: 'Alice Johnson', class: 'Grade 5', email: 'alice@school.com', password: 'student123' },
                            { id: 2, name: 'Bob Smith', class: 'Grade 6', email: 'bob@school.com', password: 'student123' },
                            { id: 3, name: 'Carol Williams', class: 'Grade 5', email: 'carol@school.com', password: 'student123' }
                        ];
                        setStudents(defaultStudents);
                        storage.set('students', JSON.stringify(defaultStudents));
                    }

                    const teachersData = storage.get('teachers');
                    if (teachersData) {
                        setTeachers(JSON.parse(teachersData.value));
                    } else {
                        const defaultTeachers = [
                            { id: 1, name: 'Mr. Anderson', subject: 'Mathematics', email: 'anderson@school.com', password: 'teacher123' },
                            { id: 2, name: 'Ms. Davis', subject: 'Science', email: 'davis@school.com', password: 'teacher123' }
                        ];
                        setTeachers(defaultTeachers);
                        storage.set('teachers', JSON.stringify(defaultTeachers));
                    }

                    const resultsData = storage.get('examResults');
                    if (resultsData) {
                        setExamResults(JSON.parse(resultsData.value));
                    } else {
                        const defaultResults = [
                            { id: 1, studentId: 1, subject: 'Mathematics', score: 85, maxScore: 100, date: '2026-01-10' },
                            { id: 2, studentId: 1, subject: 'Science', score: 92, maxScore: 100, date: '2026-01-12' },
                            { id: 3, studentId: 2, subject: 'Mathematics', score: 78, maxScore: 100, date: '2026-01-10' }
                        ];
                        setExamResults(defaultResults);
                        storage.set('examResults', JSON.stringify(defaultResults));
                    }

                    const questionsData = storage.get('questions');
                    if (questionsData) {
                        setQuestions(JSON.parse(questionsData.value));
                    } else {
                        const defaultQuestions = [
                            { id: 1, subject: 'Mathematics', question: 'What is 7 times 8?', options: ['54', '56', '63', '64'], correct: 1, class: 'Grade 5' },
                            { id: 2, subject: 'Science', question: 'What is the largest planet?', options: ['Mars', 'Jupiter', 'Saturn', 'Earth'], correct: 1, class: 'Grade 5' }
                        ];
                        setQuestions(defaultQuestions);
                        storage.set('questions', JSON.stringify(defaultQuestions));
                    }

                    const videosData = storage.get('videos');
                    if (videosData) {
                        setVideos(JSON.parse(videosData.value));
                    } else {
                        const defaultVideos = [
                            { id: 1, title: 'Introduction to Multiplication', subject: 'Mathematics', class: 'Grade 5', thumbnail: 'ðŸŽ¯', duration: '12:30' },
                            { id: 2, title: 'The Solar System', subject: 'Science', class: 'Grade 5', thumbnail: 'ðŸª', duration: '15:45' },
                            { id: 3, title: 'Reading Tips', subject: 'English', class: 'Grade 6', thumbnail: 'ðŸ“š', duration: '10:20' }
                        ];
                        setVideos(defaultVideos);
                        storage.set('videos', JSON.stringify(defaultVideos));
                    }

                    const commentsData = storage.get('disciplineComments');
                    if (commentsData) {
                        setDisciplineComments(JSON.parse(commentsData.value));
                    } else {
                        const defaultComments = [
                            { id: 1, studentId: 1, teacherId: 1, comment: 'Excellent behavior and participation', date: '2026-01-15' },
                            { id: 2, studentId: 2, teacherId: 2, comment: 'Needs to be more attentive', date: '2026-01-14' }
                        ];
                        setDisciplineComments(defaultComments);
                        storage.set('disciplineComments', JSON.stringify(defaultComments));
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setLoading(false);
                }
            };

            const saveStudents = (data) => {
                setStudents(data);
                storage.set('students', JSON.stringify(data));
            };

            const saveTeachers = (data) => {
                setTeachers(data);
                storage.set('teachers', JSON.stringify(data));
            };

            const saveExamResults = (data) => {
                setExamResults(data);
                storage.set('examResults', JSON.stringify(data));
            };

            const saveQuestions = (data) => {
                setQuestions(data);
                storage.set('questions', JSON.stringify(data));
            };

            const saveDisciplineComments = (data) => {
                setDisciplineComments(data);
                storage.set('disciplineComments', JSON.stringify(data));
            };

            const handleLogin = () => {
                let user = null;
                if (loginRole === 'student') {
                    user = students.find(s => s.email === loginEmail && s.password === loginPassword);
                    if (user) setCurrentUser({ ...user, role: 'student' });
                } else if (loginRole === 'teacher') {
                    user = teachers.find(t => t.email === loginEmail && t.password === loginPassword);
                    if (user) setCurrentUser({ ...user, role: 'teacher' });
                } else if (loginRole === 'admin') {
                    if (loginEmail === 'admin@school.com' && loginPassword === 'admin123') {
                        setCurrentUser({ id: 0, name: 'Administrator', role: 'admin', email: loginEmail });
                    }
                }
                
                if (!user && !(loginRole === 'admin' && loginEmail === 'admin@school.com')) {
                    alert('Invalid credentials');
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setActiveTab('dashboard');
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin mx-auto mb-4"><Loader /></div>
                            <p className="text-gray-600 font-medium">Loading School Portal...</p>
                        </div>
                    </div>
                );
            }

            if (!currentUser) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <div className="bg-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <div className="text-white"><BookOpen /></div>
                                </div>
                                <h1 className="text-3xl font-bold text-gray-800">School Portal</h1>
                                <p className="text-gray-600 mt-2">Sign in to continue</p>
                            </div>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Login As</label>
                                    <select value={loginRole} onChange={(e) => setLoginRole(e.target.value)} className="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                        <option value="student">Student</option>
                                        <option value="teacher">Teacher</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" value={loginEmail} onChange={(e) => setLoginEmail(e.target.value)} className="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Enter your email" />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                    <input type="password" value={loginPassword} onChange={(e) => setLoginPassword(e.target.value)} className="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Enter your password" />
                                </div>
                                
                                <button onClick={handleLogin} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition">
                                    Sign In
                                </button>
                            </div>
                            
                            <div className="mt-6 p-4 bg-gray-50 rounded-lg text-sm">
                                <p className="font-semibold text-gray-700 mb-2">Demo Credentials:</p>
                                <p className="text-gray-600">Student: alice@school.com / student123</p>
                                <p className="text-gray-600">Teacher: anderson@school.com / teacher123</p>
                                <p className="text-gray-600">Admin: admin@school.com / admin123</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="bg-white shadow-sm sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-3">
                                    <div className="bg-indigo-600 w-10 h-10 rounded-lg flex items-center justify-center text-white">
                                        <BookOpen />
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold text-gray-800">School Portal</h1>
                                        <p className="text-sm text-gray-600">{currentUser.name} - {currentUser.role}</p>
                                    </div>
                                </div>
                                
                                <button onClick={handleLogout} className="flex items-center space-x-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100">
                                    <LogOut />
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="bg-white rounded-xl shadow-sm p-6">
                            <div className="text-center py-12">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">Welcome to School Management System</h2>
                                <p className="text-gray-600">Full functionality available. Login and explore all features!</p>
                                <p className="text-sm text-green-600 mt-4">âœ“ Data persists using browser localStorage</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<SchoolManagementSystem />, document.getElementById('root'));
    </script>
</body>
</html>